// ============================================
// LANGUAGE TRANSLATIONS
// ============================================
const translations = {
  en: {
    home: "Home",
    products: "Products",
    contact: "Contact",
    cart: "Cart",
    account: "Account",
    hero_title: "Welcome to ShopHub",
    hero_subtitle: "Your One-Stop Solution for Quality Products",
    shop_now: "Shop Now",
    filters: "Filters",
    location: "Location",
    quality: "Quality",
    price: "Price",
    rating: "Rating",
    featured_products: "Featured Products",
    shopping_cart: "Shopping Cart",
    total: "Total:",
    proceed: "Proceed to Checkout",
    checkout: "Checkout",
    delivery_address: "Delivery Address",
    enter_address: "Enter address",
    confirm_address: "Confirm Address",
    payment_method: "Payment Method",
    place_order: "Place Order",
    login: "Login",
    register: "Register",
    email_or_phone: "Email or Phone",
    password: "Password",
    full_name: "Full Name",
    email: "Email",
    phone: "Phone",
    profile: "User Profile",
    name: "Name",
    address: "Address",
    save: "Save Changes",
    logout: "Logout",
    contact_us: "Contact Us",
    contact_info: "Contact Information",
    send: "Send Message",
    feedback: "Rate Your Experience",
    faq: "Frequently Asked Questions",
    faq1_q: "How do I track my order?",
    faq1_a: "You can track your order using the tracking number sent to your email after purchase.",
    faq2_q: "What is your return policy?",
    faq2_a: "We offer 30 days return policy for all items in original condition.",
    faq3_q: "Do you offer free shipping?",
    faq3_a: "Free shipping on orders above ₹500. Standard shipping otherwise.",
    about_us: "About Us",
    about_text: "ShopHub is your trusted online shopping destination.",
    quick_links: "Quick Links",
    help: "Help",
    privacy: "Privacy Policy",
    terms: "Terms",
    follow_us: "Follow Us",
    copyright: "© 2025 ShopHub. All Rights Reserved.",
    your_name: "Your Name",
    your_email: "Your Email",
    your_message: "Your Message",
    feedback_placeholder: "Your feedback...",
    add_to_cart: "Add to Cart",
    added_to_cart: "Added",
    cart_empty: "Your cart is empty"
  },
  hi: {
    home: "मुख्य पृष्ठ",
    products: "उत्पाद",
    contact: "संपर्क",
    cart: "कार्ट",
    account: "खाता",
    hero_title: "ShopHub में स्वागत है",
    hero_subtitle: "गुणवत्ता वाले उत्पादों का आपका एक-स्टॉप समाधान",
    shop_now: "अभी खरीदारी करें",
    filters: "फ़िल्टर",
    location: "स्थान",
    quality: "गुणवत्ता",
    price: "मूल्य",
    rating: "रेटिंग",
    featured_products: "विशेष उत्पाद",
    shopping_cart: "शॉपिंग कार्ट",
    total: "कुल:",
    proceed: "चेकआउट के लिए आगे बढ़ें",
    checkout: "चेकआउट",
    delivery_address: "डिलीवरी पता",
    enter_address: "पता दर्ज करें",
    confirm_address: "पता की पुष्टि करें",
    payment_method: "भुगतान विधि",
    place_order: "ऑर्डर दें",
    login: "लॉगिन",
    register: "पंजीकृत करें",
    email_or_phone: "ईमेल या फोन",
    password: "पासवर्ड",
    full_name: "पूरा नाम",
    email: "ईमेल",
    phone: "फोन",
    profile: "उपयोगकर्ता प्रोफाइल",
    name: "नाम",
    address: "पता",
    save: "परिवर्तन सहेजें",
    logout: "लॉगआउट",
    contact_us: "हमसे संपर्क करें",
    contact_info: "संपर्क जानकारी",
    send: "संदेश भेजें",
    feedback: "अपने अनुभव को रेट करें",
    faq: "अक्सर पूछे जाने वाले सवाल",
    faq1_q: "मैं अपने ऑर्डर को कैसे ट्रैक करूं?",
    faq1_a: "आप खरीद के बाद अपने ईमेल पर भेजे गए ट्रैकिंग नंबर का उपयोग करके अपने ऑर्डर को ट्रैक कर सकते हैं।",
    faq2_q: "आपकी रिटर्न नीति क्या है?",
    faq2_a: "हम मूल स्थिति में सभी वस्तुओं के लिए 30 दिन की रिटर्न नीति प्रदान करते हैं।",
    faq3_q: "क्या आप मुक्त शिपिंग प्रदान करते हैं?",
    faq3_a: "₹500 से अधिक के ऑर्डर पर मुक्त शिपिंग। अन्यथा मानक शिपिंग।",
    about_us: "हमारे बारे में",
    about_text: "ShopHub आपका विश्वसनीय ऑनलाइन शॉपिंग गंतव्य है।",
    quick_links: "त्वरित लिंक",
    help: "मदद",
    privacy: "गोपनीयता नीति",
    terms: "शर्तें",
    follow_us: "हमें फॉलो करें",
    copyright: "© 2025 ShopHub। सर्वाधिकार सुरक्षित।",
    your_name: "आपका नाम",
    your_email: "आपका ईमेल",
    your_message: "आपका संदेश",
    feedback_placeholder: "आपकी प्रतिक्रिया...",
    add_to_cart: "कार्ट में जोड़ें",
    added_to_cart: "जोड़ा गया",
    cart_empty: "आपका कार्ट खाली है"
  },
  bn: {
    home: "হোম",
    products: "পণ্য",
    contact: "যোগাযোগ",
    cart: "কার্ট",
    account: "অ্যাকাউন্ট",
    hero_title: "ShopHub এ স্বাগতম",
    hero_subtitle: "মানসম্পন্ন পণ্যের জন্য আপনার এক-স্টপ সমাধান",
    shop_now: "এখনই কেনাকাটা করুন",
    filters: "ফিল্টার",
    location: "অবস্থান",
    quality: "গুণমান",
    price: "মূল্য",
    rating: "রেটিং",
    featured_products: "বৈশিষ্ট্যযুক্ত পণ্য",
    shopping_cart: "শপিং কার্ট",
    total: "মোট:",
    proceed: "চেকআউটে যান",
    checkout: "চেকআউট",
    delivery_address: "ডেলিভারি ঠিকানা",
    enter_address: "ঠিকানা প্রবেশ করুন",
    confirm_address: "ঠিকানা নিশ্চিত করুন",
    payment_method: "পেমেন্ট পদ্ধতি",
    place_order: "অর্ডার দিন",
    login: "লগইন",
    register: "রেজিস্টার",
    email_or_phone: "ইমেল বা ফোন",
    password: "পাসওয়ার্ড",
    full_name: "সম্পূর্ণ নাম",
    email: "ইমেল",
    phone: "ফোন",
    profile: "ব্যবহারকারী প্রোফাইল",
    name: "নাম",
    address: "ঠিকানা",
    save: "পরিবর্তন সংরক্ষণ করুন",
    logout: "লগআউট",
    contact_us: "আমাদের সাথে যোগাযোগ করুন",
    contact_info: "যোগাযোগ তথ্য",
    send: "বার্তা পাঠান",
    feedback: "আপনার অভিজ্ঞতা রেট করুন",
    faq: "প্রায়শই জিজ্ঞাসিত প্রশ্নাবলী",
    faq1_q: "আমি কীভাবে আমার অর্ডার ট্র্যাক করব?",
    faq1_a: "ক্রয়ের পরে আপনার ইমেলে পাঠানো ট্র্যাকিং নম্বর ব্যবহার করে আপনি আপনার অর্ডার ট্র্যাক করতে পারেন।",
    faq2_q: "আপনার রিটার্ন নীতি কী?",
    faq2_a: "আমরা আসল অবস্থায় সমস্ত আইটেমের জন্য 30 দিনের রিটার্ন নীতি অফার করি।",
    faq3_q: "আপনি বিনামূল্যে শিপিং অফার করেন?",
    faq3_a: "₹500 এর উপরে অর্ডারে বিনামূল্যে শিপিং। অন্যথায় মানক শিপিং।",
    about_us: "আমাদের সম্পর্কে",
    about_text: "ShopHub আপনার বিশ্বস্ত অনলাইন শপিং গন্তব্য।",
    quick_links: "দ্রুত লিঙ্ক",
    help: "সাহায্য",
    privacy: "গোপনীয়তা নীতি",
    terms: "শর্তাবলী",
    follow_us: "আমাদের অনুসরণ করুন",
    copyright: "© 2025 ShopHub। সর্বাধিকার সংরক্ষিত।",
    your_name: "আপনার নাম",
    your_email: "আপনার ইমেল",
    your_message: "আপনার বার্তা",
    feedback_placeholder: "আপনার প্রতিক্রিয়া...",
    add_to_cart: "কার্টে যোগ করুন",
    added_to_cart: "যোগ করা হয়েছে",
    cart_empty: "আপনার কার্ট খালি"
  },
  fr: {
    home: "Accueil",
    products: "Produits",
    contact: "Contact",
    cart: "Panier",
    account: "Compte",
    hero_title: "Bienvenue à ShopHub",
    hero_subtitle: "Votre solution unique pour des produits de qualité",
    shop_now: "Acheter maintenant",
    filters: "Filtres",
    location: "Emplacement",
    quality: "Qualité",
    price: "Prix",
    rating: "Note",
    featured_products: "Produits vedettes",
    shopping_cart: "Panier d'achat",
    total: "Total:",
    proceed: "Procéder à la caisse",
    checkout: "Panier",
    delivery_address: "Adresse de livraison",
    enter_address: "Entrez l'adresse",
    confirm_address: "Confirmer l'adresse",
    payment_method: "Méthode de paiement",
    place_order: "Passer la commande",
    login: "Connexion",
    register: "S'inscrire",
    email_or_phone: "Email ou téléphone",
    password: "Mot de passe",
    full_name: "Nom complet",
    email: "Email",
    phone: "Téléphone",
    profile: "Profil utilisateur",
    name: "Nom",
    address: "Adresse",
    save: "Enregistrer les modifications",
    logout: "Déconnexion",
    contact_us: "Nous contacter",
    contact_info: "Informations de contact",
    send: "Envoyer le message",
    feedback: "Évaluer votre expérience",
    faq: "Questions fréquemment posées",
    faq1_q: "Comment puis-je suivre ma commande?",
    faq1_a: "Vous pouvez suivre votre commande en utilisant le numéro de suivi envoyé à votre email après l'achat.",
    faq2_q: "Quelle est votre politique de retour?",
    faq2_a: "Nous offrons une politique de retour de 30 jours pour tous les articles en bon état.",
    faq3_q: "Livrez-vous gratuitement?",
    faq3_a: "Livraison gratuite pour les commandes de plus de ₹500. Livraison standard sinon.",
    about_us: "À Propos",
    about_text: "ShopHub est votre destination de shopping en ligne de confiance.",
    quick_links: "Liens rapides",
    help: "Aide",
    privacy: "Politique de confidentialité",
    terms: "Conditions",
    follow_us: "Nous suivre",
    copyright: "© 2025 ShopHub. Tous droits réservés.",
    your_name: "Votre nom",
    your_email: "Votre email",
    your_message: "Votre message",
    feedback_placeholder: "Vos commentaires...",
    add_to_cart: "Ajouter au panier",
    added_to_cart: "Ajouté",
    cart_empty: "Votre panier est vide"
  },
  es: {
    home: "Inicio",
    products: "Productos",
    contact: "Contacto",
    cart: "Carrito",
    account: "Cuenta",
    hero_title: "Bienvenido a ShopHub",
    hero_subtitle: "Tu solución única para productos de calidad",
    shop_now: "Comprar ahora",
    filters: "Filtros",
    location: "Ubicación",
    quality: "Calidad",
    price: "Precio",
    rating: "Calificación",
    featured_products: "Productos destacados",
    shopping_cart: "Carrito de compras",
    total: "Total:",
    proceed: "Proceder al pago",
    checkout: "Pago",
    delivery_address: "Dirección de entrega",
    enter_address: "Ingrese la dirección",
    confirm_address: "Confirmar dirección",
    payment_method: "Método de pago",
    place_order: "Realizar pedido",
    login: "Iniciar sesión",
    register: "Registrarse",
    email_or_phone: "Email o teléfono",
    password: "Contraseña",
    full_name: "Nombre completo",
    email: "Correo electrónico",
    phone: "Teléfono",
    profile: "Perfil de usuario",
    name: "Nombre",
    address: "Dirección",
    save: "Guardar cambios",
    logout: "Cerrar sesión",
    contact_us: "Contáctanos",
    contact_info: "Información de contacto",
    send: "Enviar mensaje",
    feedback: "Califica tu experiencia",
    faq: "Preguntas frecuentes",
    faq1_q: "¿Cómo sigo mi pedido?",
    faq1_a: "Puede rastrear su pedido utilizando el número de seguimiento enviado a su correo electrónico después de la compra.",
    faq2_q: "¿Cuál es su política de devoluciones?",
    faq2_a: "Ofrecemos una política de devolución de 30 días para todos los artículos en condición original.",
    faq3_q: "¿Ofrecen envío gratis?",
    faq3_a: "Envío gratis en pedidos superiores a ₹500. Envío estándar de otra manera.",
    about_us: "Acerca de nosotros",
    about_text: "ShopHub es su destino de compras en línea de confianza.",
    quick_links: "Enlaces rápidos",
    help: "Ayuda",
    privacy: "Política de privacidad",
    terms: "Términos",
    follow_us: "Síguenos",
    copyright: "© 2025 ShopHub. Todos los derechos reservados.",
    your_name: "Tu nombre",
    your_email: "Tu correo electrónico",
    your_message: "Tu mensaje",
    feedback_placeholder: "Tus comentarios...",
    add_to_cart: "Añadir al carrito",
    added_to_cart: "Añadido",
    cart_empty: "Tu carrito está vacío"
  },
}

// ============================================
// SAMPLE PRODUCTS DATA
// ============================================
const products = [
  { id: 1, title: "Premium Headphones", price: 2999, location: "New York", quality: "Premium", rating: 5, image: "public/premium-headphones.jpg" },
  { id: 2, title: "Wireless Mouse", price: 999, location: "Los Angeles", quality: "Standard", rating: 4, image: "public/wireless-mouse.jpg" },
  { id: 3, title: "USB-C Cable", price: 499, location: "Chicago", quality: "Economy", rating: 4, image: "public/usb-c-cable.jpg" },
  { id: 4, title: "Laptop Stand", price: 1999, location: "New York", quality: "Premium", rating: 5, image: "public/laptop-stand.jpg" },
  { id: 5, title: "Phone Screen Protector", price: 299, location: "Los Angeles", quality: "Standard", rating: 3, image: "public/screen-protector.png" },
  { id: 6, title: "Portable Charger", price: 1499, location: "Chicago", quality: "Premium", rating: 5, image: "public/portable-charger.jpg" },
  { id: 7, title: "Keyboard", price: 3499, location: "New York", quality: "Premium", rating: 5, image: "public/mechanical-keyboard.png" },
  { id: 8, title: "Monitor", price: 8999, location: "Los Angeles", quality: "Premium", rating: 4, image: "public/computer-monitor.png" },
]

let currentLanguage = localStorage.getItem("language") || "en"
let cart = JSON.parse(localStorage.getItem("cart")) || []
let currentUser = JSON.parse(localStorage.getItem("currentUser")) || null

// ============================================
// UTILITY FUNCTIONS
// ============================================
function updateUIText() {
  $("[data-lang]").each(function () {
    const key = $(this).data("lang")
    if (translations[currentLanguage][key]) {
      $(this).text(translations[currentLanguage][key])
    }
  })

  $("[data-lang-placeholder]").each(function () {
    const key = $(this).data("lang-placeholder")
    if (translations[currentLanguage][key]) {
      $(this).attr("placeholder", translations[currentLanguage][key])
    }
  })
}

function t(key) {
  return translations[currentLanguage][key] || key
}

// ============================================
// AVATAR UPDATE
// ============================================
function updateAvatar() {
  const $avatar = $("#avatarImg")
  if (currentUser && currentUser.avatar) {
    $avatar.attr("src", currentUser.avatar)
  } else {
    $avatar.attr("src", "public/default-avatar.png")
  }
}

// ============================================
// THEME TOGGLE
// ============================================
function initTheme() {
  const savedTheme = localStorage.getItem("theme") || "light"
  if (savedTheme === "dark") {
    $("body").addClass("dark-mode")
    $("#themeToggle i").removeClass("fa-moon").addClass("fa-sun")
  }
}

$("#themeToggle").click(function () {
  $("body").toggleClass("dark-mode")
  const isDark = $("body").hasClass("dark-mode")
  localStorage.setItem("theme", isDark ? "dark" : "light")
  $(this).find("i").toggleClass("fa-moon fa-sun")
})

// ============================================
// LANGUAGE SELECTOR
// ============================================
$("#languageSelect").change(function () {
  currentLanguage = $(this).val()
  localStorage.setItem("language", currentLanguage)
  updateUIText()
  renderProducts()
})

// ============================================
// CART FUNCTIONALITY
// ============================================
function updateCartCount() {
  const total = cart.reduce((sum, i) => sum + i.quantity, 0)
  $("#cartCount").text(total)
}

function addToCart(productId) {
  if (!currentUser) {
    showAuthModal()
    return
  }

  const product = products.find(p => p.id === productId)
  const existing = cart.find(i => i.id === productId)

  if (existing) existing.quantity++
  else cart.push({ ...product, quantity: 1 })

  localStorage.setItem("cart", JSON.stringify(cart))
  updateCartCount()
  renderProducts()
}

function renderCartModal() {
  const $items = $("#cartItems").empty()
  const $total = $("#cartTotal")

  if (cart.length === 0) {
    $items.append(`<p class="empty-cart" style="text-align:center; color:var(--text-light); padding:20px;">${t('cart_empty')}</p>`)
    $("#proceedCheckout").prop('disabled', true)
    $total.text('₹0')
    return
  }

  let grandTotal = 0
  cart.forEach(item => {
    const lineTotal = item.price * item.quantity
    grandTotal += lineTotal

    const $row = $(`
      <div class="cart-item">
        <div class="cart-item-info">
          <div class="cart-item-title">${item.title}</div>
          <div class="cart-item-price">₹${lineTotal}</div>
        </div>
        <div class="quantity-controls">
          <button class="qty-btn minus" data-id="${item.id}">-</button>
          <span class="qty">${item.quantity}</span>
          <button class="qty-btn plus" data-id="${item.id}">+</button>
        </div>
        <button class="remove-btn" data-id="${item.id}"><i class="fas fa-trash"></i></button>
      </div>
    `)
    $items.append($row)
  })

  $total.text('₹' + grandTotal)
  $("#proceedCheckout").prop('disabled', false)
}

$("#cartBtn").on('click', () => {
  if (!currentUser) {
    showAuthModal()
    return
  }
  renderCartModal()
  $("#cartModal").fadeIn()
})

$("#cartItems").on('click', '.qty-btn', function () {
  const id = $(this).data('id')
  const item = cart.find(i => i.id === id)
  if (!item) return

  if ($(this).hasClass('plus')) item.quantity++
  if ($(this).hasClass('minus')) item.quantity = Math.max(1, item.quantity - 1)

  saveCartAndRefresh()
})

$("#cartItems").on('click', '.remove-btn', function () {
  const id = $(this).data('id')
  cart = cart.filter(i => i.id !== id)
  saveCartAndRefresh()
})

function saveCartAndRefresh() {
  localStorage.setItem("cart", JSON.stringify(cart))
  updateCartCount()
  renderCartModal()
  renderProducts()
}

$("#proceedCheckout").on('click', () => {
  if (cart.length === 0) return
  $("#cartModal").fadeOut()
  $("#checkoutModal").fadeIn()
})

// ============================================
// PRODUCTS RENDERING
// ============================================
function renderProducts(productsToShow = products) {
  $("#productsList").empty()

  productsToShow.forEach(p => {
    const inCart = cart.find(i => i.id === p.id)
    const btnClass = inCart ? 'btn-success' : 'btn-primary'
    const btnText = inCart ? t('added_to_cart') : t('add_to_cart')
    const stars = "★".repeat(p.rating) + "☆".repeat(5 - p.rating)

    const html = `
      <div class="product-card">
        <img src="${p.image}" alt="${p.title}" class="product-image">
        <div class="product-content">
          <h3 class="product-title">${p.title}</h3>
          <p class="product-location">${p.location}</p>
          <span class="product-quality">${p.quality}</span>
          <div class="product-rating">${stars}</div>
          <div class="product-price">₹${p.price}</div>
          <div class="product-actions">
            <button class="btn add-to-cart ${btnClass}" data-id="${p.id}">${btnText}</button>
          </div>
        </div>
      </div>`
    $("#productsList").append(html)
  })

  $(".add-to-cart").off('click').on('click', function () {
    const id = $(this).data('id')
    addToCart(id)
  })
}

// ============================================
// CHECKOUT
// ============================================
$("#addressForm").submit((e) => {
  e.preventDefault()
  const address = $("#addressInput").val()
  $("#paymentOptions").slideDown()
})

$("#placeOrder").on('click', () => {
  const payment = $('input[name="payment"]:checked').val()
  if (!payment) {
    alert("Please select a payment method")
    return
  }
  alert(`Order placed successfully! Payment: ${payment}`)
  cart = []
  localStorage.setItem("cart", JSON.stringify(cart))
  updateCartCount()
  $("#checkoutModal").fadeOut()
  $("#paymentOptions").slideUp()
  renderCartModal()
})

// ============================================
// AUTHENTICATION
// ============================================
$("#userBtn").click(() => {
  if (currentUser) {
    showProfileModal()
  } else {
    showAuthModal()
  }
})

function showAuthModal() {
  $("#authModal").fadeIn()
}

function showProfileModal() {
  $("#profileName").text(currentUser.name)
  $("#profileEmail").text(currentUser.email)
  $("#profilePhone").text(currentUser.phone)
  $("#profileAddress").val(currentUser.address || "")
  $("#profileModal").fadeIn()
}

$("#loginTab").click(function () {
  $(this).addClass("active")
  $("#registerTab").removeClass("active")
  $("#loginForm").addClass("active")
  $("#registerForm").removeClass("active")
})

$("#registerTab").click(function () {
  $(this).addClass("active")
  $("#loginTab").removeClass("active")
  $("#registerForm").addClass("active")
  $("#loginForm").removeClass("active")
})

$("#loginForm").submit((e) => {
  e.preventDefault()
  const identity = $("#loginIdentity").val()
  const password = $("#loginPassword").val()

  const users = JSON.parse(localStorage.getItem("users")) || []
  const user = users.find((u) => (u.email === identity || u.phone === identity) && u.password === password)

  if (user) {
    currentUser = user
    localStorage.setItem("currentUser", JSON.stringify(user))
    $("#authModal").fadeOut()
    updateAvatar()
    updateUIText()
  } else {
    $("#loginError").text("Invalid credentials!")
  }
})

$("#registerForm").submit((e) => {
  e.preventDefault()
  const name = $("#regName").val()
  const email = $("#regEmail").val()
  const phone = $("#regPhone").val()
  const password = $("#regPassword").val()

  const users = JSON.parse(localStorage.getItem("users")) || []

  if (users.find((u) => u.email === email)) {
    $("#registerError").text("Email already exists!")
    return
  }

  const newUser = { name, email, phone, password, address: "", avatar: "" }
  users.push(newUser)
  localStorage.setItem("users", JSON.stringify(users))

  currentUser = newUser
  localStorage.setItem("currentUser", JSON.stringify(newUser))
  $("#authModal").fadeOut()
  $("#registerForm")[0].reset()
  updateAvatar()
  updateUIText()
})

$("#logoutBtn").click(() => {
  currentUser = null
  localStorage.removeItem("currentUser")
  cart = []
  localStorage.setItem("cart", JSON.stringify(cart))
  updateCartCount()
  $("#profileModal").fadeOut()
  renderProducts()
  updateAvatar()
  updateUIText()
})

$("#saveProfile").click(() => {
  currentUser.address = $("#profileAddress").val()
  localStorage.setItem("currentUser", JSON.stringify(currentUser))

  const users = JSON.parse(localStorage.getItem("users")) || []
  const index = users.findIndex((u) => u.email === currentUser.email)
  if (index !== -1) {
    users[index] = currentUser
    localStorage.setItem("users", JSON.stringify(users))
  }

  alert("Profile updated successfully!")
  $("#profileModal").fadeOut()
})

// Optional: Avatar upload (if you added the input in HTML)
$(document).on("change", "#avatarUpload", function(e) {
  const file = e.target.files[0]
  if (!file) return
  const reader = new FileReader()
  reader.onload = function(ev) {
    const dataUrl = ev.target.result
    currentUser.avatar = dataUrl
    localStorage.setItem("currentUser", JSON.stringify(currentUser))
    updateAvatar()
    $("#avatarPreview").attr("src", dataUrl).show()
  }
  reader.readAsDataURL(file)
})

// ============================================
// FILTERING
// ============================================
function applyFilters() {
  let filtered = [...products]
  const location = $("#locationFilter").val()
  const quality = $("#qualityFilter").val()
  const priceSort = $("#priceFilter").val()
  const rating = $("#ratingFilter").val()

  if (location) filtered = filtered.filter(p => p.location === location)
  if (quality) filtered = filtered.filter(p => p.quality === quality)
  if (rating) filtered = filtered.filter(p => p.rating >= Number.parseInt(rating))

  if (priceSort === "low-high") filtered.sort((a, b) => a.price - b.price)
  else if (priceSort === "high-low") filtered.sort((a, b) => b.price - a.price)

  renderProducts(filtered)
}

$("#locationFilter, #qualityFilter, #priceFilter, #ratingFilter").change(applyFilters)

// ============================================
// SEARCH
// ============================================
$("#searchInput").on("keyup", function () {
  const searchTerm = $(this).val().toLowerCase()
  const filtered = products.filter(p => p.title.toLowerCase().includes(searchTerm))
  renderProducts(filtered)
})

// ============================================
// CONTACT FORM
// ============================================
$(".contact-form").submit(function (e) {
  e.preventDefault()
  alert("Thank you for contacting us! We will respond soon.")
  this.reset()
})

// ============================================
// STAR RATING
// ============================================
$(".star-rating i").click(function () {
  const rating = $(this).data("rating")
  $(".star-rating i").each(function () {
    $(this).toggleClass("active", $(this).data("rating") <= rating)
  })
})

// ============================================
// MODAL CLOSE
// ============================================
$(".close").click(function () {
  $(this).closest(".modal").fadeOut()
})

$(window).click((event) => {
  if ($(event.target).hasClass("modal")) {
    $(event.target).fadeOut()
  }
})

// ============================================
// HAMBURGER MENU
// ============================================
$("#hamburger").click(() => {
  $(".nav-menu").toggleClass("active")
})

// ============================================
// HERO BUTTON
// ============================================
$(".hero-btn").click(() => {
  $("html, body").animate({ scrollTop: $("#products").offset().top }, 800)
})

// ============================================
// INITIALIZATION
// ============================================
$(document).ready(() => {
  initTheme()
  updateUIText()
  renderProducts()
  updateCartCount()
  updateAvatar()
})
